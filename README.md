# Systems Analysis. Homeworks of the educational course Systems Analysis
# Week 1. Working with requirements, dividing the system into elements

## Домашнее задание
-[x] Создать event storming диаграмму;
-[x] Создать модель данных;
-[x] Описать принятые решения.

## Модели
[На доске miro расположены диаграммы](https://miro.com/app/board/uXjVMHGq3Q0=/?share_link_id=940434293337):
* Event Storming (ES);
* Data model;
* Модель связей в системе.

Модели так же прикреплены в репозитории. Описание системы и решений в моделях приведены ниже.

## Описание моделей и системы

### Основной контекст MCF 
При создании нового заказа на услугу клиентом, необходимо определить ее тип.
Для того, чтобы сотрудник MCF мог приступить к исполнению задачи должны произойти события:
• назначение worker
• Подготовка расходников
Т.о. контекст связан с контекстом матчинга и контекстом склада.

* Задача может быть создана пользователем с нуля. При этом необходимо выбрать тип, время и ввести описание;
* При создании задачи пользователь видит примерную стоимость заказываемой услуги, привязанную к типу заказываемой услуги. При этом пользователь уведомлен, что стоимость примерная. [^12], [^22]
* Задача может быть создана кроном, установленным на желаемую дату исполнения услуги, если исполнение не началось. Т.о. та задача, что не была начата своевроеменно, помечается проваленной, на ее основе создается копия и клиенту уходит запрос на новую желаемую дату;
* При добавлении новой услуги в список заказанных услуг происходит запрос на подбор worker в контекст матчинга
* При добавлении новой услуги в список заказанных услуг происходит запрос на сборку расходников на складе
* При добавлении новой услуги в список заказанных услуг происходит запрос на доставку печенья на складе
* Автоматической доставки расходников нет, т.о. worker обращается на склад сам при получении нотификации
* Для услуги устанавливается крон (или скедулер) для проверки своевременного начала
* При срабатывании крона проверяется статус услуги и если исполнение не началось, заказ помечается как проваленный.  Данное событие расположено в контексте подготовки задачи к исполнению, т.к. он контролируется системой MCF. Контекст исполнения услуги, фактически, внешний.
* На любом из этапов подготовки заказа к исполнению клиент может отменить услугу
* При отмене или провале услуги уведомляется отдел обеспечения качества

### Контекст исполнения заказа на услугу
Контекст тесно связан с внешним миром и влияет на MCF лишь путем прямой смены статуса заказа.
Случай, когда worker не начал исполнять заказ вовремя, контролируется контекстом подготовки заказа 
# Исполнение заказа начинается в выбранное клиентом время
# Заказ переводится в статус начатого тогда, когда worker загрузил фото с места исполнения
# Заказ считается завершенным, когда worker загрузил форму заказа услуги [^26]

### Контекст матчинга
Для того, чтобы в пуле появился worker, необходимо, чтобы он прошел тестирование. Т.о. контекст матчинга связан с контекстом подбора worker.
* Worker подбирается из пула ``Worker pool`` на основании данных клиента и данных услуги;
* В пуле всегда есть worker, которого можно вытащить к заказу;
* Подобранный worker назначается на заказ;
* Исходя из характеристик worker выставляется окончательная цена [^11], [^21]

### Контекст склада
Контекст склада вызывается из контекста подготовки заказа к исполнению.
* Склад получает заказ на сборку расходников, содержащий описание клиента и заказа услуги;
* Через склад происходит заказ печенья усторожено поставщика;
* Собранный набор содержит расходники, бланк заказа и печенье;
* При завершении сборки нотификация уходит worker;
* При обращении worker сотрудник склада отдает собранный набор и отмечает, что расходники выданы.

### Управление услугами
Типы услуг контролируют менеджеры MCF.
* Менеджер может добавить новую услугу;
* Менеджер может изменить услугу [^27];
* Менеджер может удалить услугу [^28];
* Пока нет ответа на вопросы от бизнеса, предполагаем, что изменения, сделанные менеджерами, не влияют на уже имеющиеся задачи;
* В случае, если будет принято решение, что удаление или изменение типа услуги влияет на созданные заказы услуг, контекст управления услугами будет уведомлять контекст подготовки созданного заказа.

### Оценка качества работы worker-ов
На контроль попадают все неуспешные заказы услуг и выборочно те, что завершились успешно.
* Watcher, наблюдающий за статусами заказов создает задачи на проверку каждого неуспешного заказа услуги
* Watcher создает задачи на проверку успешно завершенных заказов по внутреннему алгоритму [^29]. ``Пока нет ответа, считаем, что дополнительных событий нет``;
* Менеджер контроля качества заполняет форму оценки качества проверяемой услуги;
* Если исходя из информации, имеющейся в системе, нельзя разобраться в причинах, менеджер связывается с клиентом [^210]. ``Пока нет ответа, считаем что связь идет во внешней среде (например, телефонный звонок)``;
* Менеджер может начислить любую сумму для worker на свое усмотрение;

### Биллинг
Для упрощения считаю, что все банковские операции проходят во внешней системе.
* Затраты клиента рассчитываются раз в неделю;
* Исходя из суммы затрат начисляется скидка;
* Детали списаний сохраняются для дальнейшего использования клиентом;
* Заработок worker-a рассчитывается раз в месяц;
* Биллинг принимает заказы worker-a и начисляет заработанную сумму за каждый успешный заказ;
* Биллинг начисляет штраф на каждый проваленный заказ;
* Биллинг начисляет сумму поощрений от менеджеров;
* Детали начислений и штрафов со-равняются для дальнейшего использования worker-ом;
* Инвойс создается и передается в работу внешней системе.

### Help desk
* Клиент может запросить помощь по конкретной услуге;
* Клиент может запросить помощь, не связанную с конкретной услугой.

### Система ставок
Менеджеры сами распределяют финансы после получения результата сыгранных ставок.
Проводки финансов идут вне системы MCF  и т.о. не проходят через внутренний биллинг.
* Менеджер делает ставку на заказанную услугу;
* Watcher наблюдает за появлением завершенных, проваленных и отмененных заказов на услуги и рассчитывает суммы выигрыша для менеджеров;
* Если все менеджеры проиграли, сумма уходит разработчикам.

### Допущения в текущей версии модели:
[^11]: Предполагаю, что итоговая цена услуги рассчитывается из базовой ставки услуги и рейта worker [^21]

[^12]: Предполагаю, что клиент видит базовую стоимость заказа на основании типа услуги [^22]

### Вопросы к бизнесу:
[^21]: Как рассчитывается цена услуги? Есть ли «рейт» у worker или рассвет идет от сильных и слабых сторон алгоритмом? 

[^22]: Видит ли клиент примерную стоимость до подбора worker?

[^23]: Что происходит с расходниками, если worker не явился на заказ?

[^24]: Нужно ли уведомлять склад при отмене заказа клиентом и прерывать сборку?

[^25]: Допускается ли опоздание worker-a?

[^26]: Как должна вести себя система, если клиент не подписал бланк?

[^27]: Уведомляется ли клиент, если менеджер изменил тип услуг?

[^28]: Возможна ли ситуация, когда менеджер удалил тип услуг, заказы с которым в процессе? Как система должна отреагировать, если такое возможно?

[^29]: Кто и как определяет, какие из удачно завершенных заказов попадают на контроль качества?

[^210]: Связь сотрудника отдела качества с клиентом происходит внутри MCF или вовне?